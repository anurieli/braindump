# Graph RAG Architecture - Visual Guide
**Brain Dump Canvas Intelligence System**

**Date Created**: November 8, 2025

---

## ğŸ—ï¸ System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER INTERFACE                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Canvas  â”‚  â”‚  Search  â”‚  â”‚  Chat    â”‚  â”‚ Clusters â”‚       â”‚
â”‚  â”‚  View    â”‚  â”‚  Bar     â”‚  â”‚  Panel   â”‚  â”‚  View    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚             â”‚
        â–¼             â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         API LAYER                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Ideas   â”‚  â”‚  Search  â”‚  â”‚   Chat   â”‚  â”‚  Layout  â”‚       â”‚
â”‚  â”‚   API    â”‚  â”‚   API    â”‚  â”‚   API    â”‚  â”‚   API    â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚             â”‚
        â–¼             â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      BUSINESS LOGIC                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Embeddingâ”‚  â”‚  Vector  â”‚  â”‚  Graph   â”‚  â”‚ Cluster  â”‚       â”‚
â”‚  â”‚Generator â”‚  â”‚  Search  â”‚  â”‚   RAG    â”‚  â”‚ Detectionâ”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚             â”‚
        â–¼             â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       DATABASE LAYER                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Ideas   â”‚  â”‚  Edges   â”‚  â”‚Similarityâ”‚  â”‚ Clusters â”‚       â”‚
â”‚  â”‚  Table   â”‚  â”‚  Table   â”‚  â”‚  Cache   â”‚  â”‚  Table   â”‚       â”‚
â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚       â”‚
â”‚  â”‚ +embeddingâ”‚ â”‚ +type    â”‚  â”‚ +scores  â”‚  â”‚ +theme   â”‚       â”‚
â”‚  â”‚ +context_ â”‚  â”‚ +label   â”‚  â”‚          â”‚  â”‚ +members â”‚       â”‚
â”‚  â”‚  embeddingâ”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   PostgreSQL     â”‚
            â”‚   + pgvector     â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow: Creating an Idea

```
User types idea
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend       â”‚  "Build user authentication"
â”‚  Input Box      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/     â”‚  { content: "Build user authentication",
â”‚  ideas          â”‚    x: 500, y: 300 }
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Insert into    â”‚  INSERT INTO ideas (content, x, y, state)
â”‚  Database       â”‚  VALUES (..., 'generating')
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚                                      â”‚
         â–¼                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Background Job â”‚                  â”‚  Return to      â”‚
â”‚  Queue          â”‚                  â”‚  Frontend       â”‚
â”‚                 â”‚                  â”‚  (optimistic)   â”‚
â”‚  1. Generate    â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â”‚     embedding   â”‚
â”‚                 â”‚
â”‚  2. Generate    â”‚
â”‚     context     â”‚
â”‚     embedding   â”‚
â”‚                 â”‚
â”‚  3. Generate    â”‚
â”‚     summary     â”‚
â”‚     (if long)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OpenAI API     â”‚  text-embedding-3-small
â”‚                 â”‚  â†’ [0.123, -0.456, 0.789, ...]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜         (1536 numbers)
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Update idea    â”‚  UPDATE ideas
â”‚  with embeddingsâ”‚  SET embedding = [...],
â”‚  and summary    â”‚      context_embedding = [...],
â”‚                 â”‚      summary = "...",
â”‚                 â”‚      state = 'ready'
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Data Flow: Semantic Search

```
User searches: "authentication"
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Search Bar     â”‚  mode: 'semantic'
â”‚  (Frontend)     â”‚  query: "authentication"
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GET /api/      â”‚  ?q=authentication
â”‚  search         â”‚  &mode=semantic
â”‚                 â”‚  &threshold=0.7
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Generate       â”‚  OpenAI API
â”‚  Query          â”‚  "authentication"
â”‚  Embedding      â”‚  â†’ [0.234, -0.567, ...]
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Vector Search  â”‚  SELECT * FROM match_ideas(
â”‚  (Database)     â”‚    query_embedding,
â”‚                 â”‚    threshold: 0.7,
â”‚                 â”‚    limit: 20
â”‚                 â”‚  )
â”‚                 â”‚
â”‚  Uses IVFFlat   â”‚  Compares query vector with
â”‚  Index          â”‚  all idea embeddings using
â”‚                 â”‚  cosine similarity
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Results:       â”‚  [
â”‚                 â”‚    {id: "idea-1", similarity: 0.92,
â”‚  - "Build user  â”‚     content: "Build user auth"},
â”‚    auth" (0.92) â”‚    {id: "idea-2", similarity: 0.85,
â”‚                 â”‚     content: "Login system"},
â”‚  - "Login       â”‚    {id: "idea-3", similarity: 0.78,
â”‚    system"      â”‚     content: "Password security"}
â”‚    (0.85)       â”‚  ]
â”‚                 â”‚
â”‚  - "Password    â”‚
â”‚    security"    â”‚
â”‚    (0.78)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Return to      â”‚  Display results with
â”‚  Frontend       â”‚  similarity scores
â”‚                 â”‚  Highlight on canvas
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¤– Data Flow: Graph RAG Chat

```
User selects 3 ideas and asks:
"How do these ideas connect?"
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend: Multi-Select + Chat                              â”‚
â”‚                                                              â”‚
â”‚  Selected: [idea-1, idea-2, idea-3]                        â”‚
â”‚  Query: "How do these ideas connect?"                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/chat/multi-idea                                  â”‚
â”‚                                                              â”‚
â”‚  Body: {                                                     â”‚
â”‚    ideaIds: ["idea-1", "idea-2", "idea-3"],                â”‚
â”‚    query: "How do these ideas connect?",                    â”‚
â”‚    contextOptions: {                                         â”‚
â”‚      includeConnected: true,                                â”‚
â”‚      maxDepth: 2,                                           â”‚
â”‚      includeClusters: true                                  â”‚
â”‚    }                                                         â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Build Graph RAG Context                                     â”‚
â”‚                                                              â”‚
â”‚  1. Get selected ideas (content, embeddings, metadata)      â”‚
â”‚                                                              â”‚
â”‚  2. Traverse graph to find connected ideas:                 â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚     â”‚ idea-1  â”‚â”€â”€relates_toâ”€â”€â–¶ idea-4                       â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚          â”‚                                                   â”‚
â”‚     depends_on                                              â”‚
â”‚          â”‚                                                   â”‚
â”‚          â–¼                                                   â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚     â”‚ idea-2  â”‚â”€â”€inspired_byâ”€â”€â–¶ idea-5                      â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚          â”‚                                                   â”‚
â”‚     blocks                                                  â”‚
â”‚          â”‚                                                   â”‚
â”‚          â–¼                                                   â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                             â”‚
â”‚     â”‚ idea-3  â”‚â”€â”€similar_toâ”€â”€â–¶ idea-6                       â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                             â”‚
â”‚                                                              â”‚
â”‚  3. Find clusters these ideas belong to                     â”‚
â”‚     - idea-1, idea-4 â†’ "Backend Architecture" cluster       â”‚
â”‚     - idea-2, idea-5 â†’ "User Experience" cluster           â”‚
â”‚     - idea-3, idea-6 â†’ "Security" cluster                  â”‚
â”‚                                                              â”‚
â”‚  4. Get spatial context (what's nearby on canvas)          â”‚
â”‚     - idea-1 at (100, 200) â†’ top-left quadrant             â”‚
â”‚     - idea-2 at (500, 300) â†’ center                        â”‚
â”‚     - idea-3 at (800, 400) â†’ bottom-right                  â”‚
â”‚                                                              â”‚
â”‚  5. Get temporal context (when created)                     â”‚
â”‚     - idea-1: 2 days ago                                    â”‚
â”‚     - idea-2: 1 day ago                                     â”‚
â”‚     - idea-3: 3 hours ago                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Build AI Prompt with Rich Context                          â”‚
â”‚                                                              â”‚
â”‚  You are analyzing a knowledge graph. Here's the context:   â”‚
â”‚                                                              â”‚
â”‚  SELECTED IDEAS:                                             â”‚
â”‚  1. [idea-1] "Build user authentication system"             â”‚
â”‚     - Created: 2 days ago                                   â”‚
â”‚     - Location: top-left quadrant                           â”‚
â”‚     - Cluster: Backend Architecture                         â”‚
â”‚                                                              â”‚
â”‚  2. [idea-2] "Design login page UI"                         â”‚
â”‚     - Created: 1 day ago                                    â”‚
â”‚     - Location: center                                      â”‚
â”‚     - Cluster: User Experience                              â”‚
â”‚                                                              â”‚
â”‚  3. [idea-3] "Implement password encryption"                â”‚
â”‚     - Created: 3 hours ago                                  â”‚
â”‚     - Location: bottom-right                                â”‚
â”‚     - Cluster: Security                                     â”‚
â”‚                                                              â”‚
â”‚  RELATIONSHIPS:                                              â”‚
â”‚  - idea-1 relates_to idea-4 "Database schema for users"    â”‚
â”‚  - idea-2 depends_on idea-1                                 â”‚
â”‚  - idea-3 blocks idea-2 (must encrypt before showing UI)   â”‚
â”‚  - idea-3 similar_to idea-6 "Two-factor authentication"    â”‚
â”‚                                                              â”‚
â”‚  CONNECTED IDEAS (within 2 hops):                           â”‚
â”‚  - idea-4: "Database schema for users"                      â”‚
â”‚  - idea-5: "Mobile responsive design"                       â”‚
â”‚  - idea-6: "Two-factor authentication"                      â”‚
â”‚                                                              â”‚
â”‚  CLUSTER THEMES:                                             â”‚
â”‚  - Backend Architecture: Database, API, Auth                â”‚
â”‚  - User Experience: UI/UX, Forms, Navigation               â”‚
â”‚  - Security: Encryption, Auth, Privacy                      â”‚
â”‚                                                              â”‚
â”‚  QUESTION: "How do these ideas connect?"                    â”‚
â”‚                                                              â”‚
â”‚  Provide a comprehensive answer considering:                â”‚
â”‚  - Direct relationships (edges)                             â”‚
â”‚  - Thematic connections (clusters)                          â”‚
â”‚  - Temporal progression (creation order)                    â”‚
â”‚  - Spatial organization (canvas layout)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OpenAI API (GPT-4)                                          â”‚
â”‚                                                              â”‚
â”‚  Processes rich context and generates response              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  AI Response:                                                â”‚
â”‚                                                              â”‚
â”‚  "These three ideas form a cohesive authentication flow:    â”‚
â”‚                                                              â”‚
â”‚   1. **Backend Foundation** (idea-1): The authentication    â”‚
â”‚      system is the core, connecting to the database schema  â”‚
â”‚      (idea-4) for user storage.                             â”‚
â”‚                                                              â”‚
â”‚   2. **User Interface** (idea-2): The login page depends    â”‚
â”‚      on the auth system being built first. It's part of     â”‚
â”‚      your User Experience cluster, which also includes      â”‚
â”‚      mobile responsive design (idea-5).                     â”‚
â”‚                                                              â”‚
â”‚   3. **Security Layer** (idea-3): Password encryption is    â”‚
â”‚      blocking the UI implementation - you wisely want to    â”‚
â”‚      secure the backend before exposing it. This connects   â”‚
â”‚      to your broader security thinking, including two-      â”‚
â”‚      factor authentication (idea-6).                        â”‚
â”‚                                                              â”‚
â”‚   **Temporal Pattern**: You started with backend (2 days    â”‚
â”‚   ago), then UI (1 day ago), and most recently security    â”‚
â”‚   (3 hours ago) - showing a logical progression from        â”‚
â”‚   foundation â†’ interface â†’ hardening.                       â”‚
â”‚                                                              â”‚
â”‚   **Spatial Pattern**: These ideas span the canvas from     â”‚
â”‚   top-left (backend) to center (UI) to bottom-right        â”‚
â”‚   (security), suggesting you mentally separate concerns.    â”‚
â”‚                                                              â”‚
â”‚   **Recommendation**: Complete idea-3 (encryption) before   â”‚
â”‚   proceeding with idea-2 (login UI) to maintain security-  â”‚
â”‚   first approach."                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ Data Flow: Auto-Layout Canvas

```
User clicks "Arrange by Similarity"
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/brain-dumps/{id}/layout                          â”‚
â”‚                                                              â”‚
â”‚  Body: {                                                     â”‚
â”‚    method: 'force-directed',                                â”‚
â”‚    options: {                                                â”‚
â”‚      similarityWeight: 0.5,                                 â”‚
â”‚      edgeWeight: 0.3,                                       â”‚
â”‚      preserveAnchors: true                                  â”‚
â”‚    }                                                         â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Fetch All Ideas + Edges + Embeddings                       â”‚
â”‚                                                              â”‚
â”‚  Ideas: [{id, x, y, embedding}, ...]                        â”‚
â”‚  Edges: [{source, target, type}, ...]                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Calculate Pairwise Similarities                             â”‚
â”‚                                                              â”‚
â”‚  For each pair of ideas:                                     â”‚
â”‚    similarity = cosine_similarity(                          â”‚
â”‚      idea1.embedding,                                        â”‚
â”‚      idea2.embedding                                         â”‚
â”‚    )                                                         â”‚
â”‚                                                              â”‚
â”‚  Store in Map:                                               â”‚
â”‚    "idea-1|idea-2" â†’ 0.89                                   â”‚
â”‚    "idea-1|idea-3" â†’ 0.45                                   â”‚
â”‚    "idea-2|idea-3" â†’ 0.78                                   â”‚
â”‚    ...                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Force-Directed Layout Algorithm                             â”‚
â”‚                                                              â”‚
â”‚  Initialize:                                                 â”‚
â”‚    - Each idea is a node with position (x, y)               â”‚
â”‚    - Each node has velocity (vx, vy) = (0, 0)              â”‚
â”‚                                                              â”‚
â”‚  For 100 iterations:                                         â”‚
â”‚    1. REPULSION: All nodes push away from each other        â”‚
â”‚       force = repulsionStrength / distanceÂ²                 â”‚
â”‚                                                              â”‚
â”‚    2. EDGE ATTRACTION: Connected nodes pull together        â”‚
â”‚       force = distance Ã— edgeWeight                         â”‚
â”‚                                                              â”‚
â”‚    3. SIMILARITY ATTRACTION: Similar nodes pull together    â”‚
â”‚       force = distance Ã— similarityWeight Ã— similarity      â”‚
â”‚                                                              â”‚
â”‚    4. BOUNDARY: Keep nodes within canvas bounds             â”‚
â”‚                                                              â”‚
â”‚    5. UPDATE POSITIONS:                                      â”‚
â”‚       x += vx Ã— alpha  (alpha decreases each iteration)     â”‚
â”‚       y += vy Ã— alpha                                        â”‚
â”‚       vx *= 0.9  (damping)                                  â”‚
â”‚       vy *= 0.9                                             â”‚
â”‚                                                              â”‚
â”‚  Result: Nodes settle into positions where:                 â”‚
â”‚    - Similar ideas are close together                       â”‚
â”‚    - Connected ideas are close together                     â”‚
â”‚    - All ideas have space (repulsion)                       â”‚
â”‚    - Layout is balanced and aesthetic                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Return New Positions                                        â”‚
â”‚                                                              â”‚
â”‚  {                                                           â”‚
â”‚    updates: [                                                â”‚
â”‚      {id: "idea-1", x: 234, y: 456},                       â”‚
â”‚      {id: "idea-2", x: 567, y: 890},                       â”‚
â”‚      {id: "idea-3", x: 123, y: 789},                       â”‚
â”‚      ...                                                     â”‚
â”‚    ]                                                         â”‚
â”‚  }                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Frontend: Animate Transitions                               â”‚
â”‚                                                              â”‚
â”‚  For each idea:                                              â”‚
â”‚    - Smoothly animate from old (x, y) to new (x, y)        â”‚
â”‚    - Duration: 1 second                                     â”‚
â”‚    - Easing: ease-in-out                                    â”‚
â”‚                                                              â”‚
â”‚  Result: Beautiful, organic layout where similar ideas      â”‚
â”‚          cluster together naturally                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”— Database Schema Relationships

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      brain_dumps                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ id (PK)                                                 â”‚ â”‚
â”‚  â”‚ name                                                    â”‚ â”‚
â”‚  â”‚ viewport_x, viewport_y, viewport_zoom                  â”‚ â”‚
â”‚  â”‚ theme                                                   â”‚ â”‚
â”‚  â”‚ created_at, updated_at                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         ideas                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ id (PK)                                                 â”‚ â”‚
â”‚  â”‚ brain_dump_id (FK) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚ â”‚
â”‚  â”‚ content                                    â”‚           â”‚ â”‚
â”‚  â”‚ summary                                    â”‚           â”‚ â”‚
â”‚  â”‚ x, y (position)                           â”‚           â”‚ â”‚
â”‚  â”‚ state ('generating' | 'ready' | 'error') â”‚           â”‚ â”‚
â”‚  â”‚ embedding vector(1536) â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ context_embedding vector(1536) [NEW]      â”‚         â”‚ â”‚ â”‚
â”‚  â”‚ structural_features jsonb [NEW]           â”‚         â”‚ â”‚ â”‚
â”‚  â”‚ session_id                                 â”‚         â”‚ â”‚ â”‚
â”‚  â”‚ metadata jsonb                             â”‚         â”‚ â”‚ â”‚
â”‚  â”‚ created_at, updated_at                    â”‚         â”‚ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚ â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
         â”‚                                                      â”‚
         â”‚ N:N (via edges)                                      â”‚
         â”‚                                                      â”‚
         â–¼                                                      â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                         edges                                â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ id (PK)                                                 â”‚ â”‚ â”‚
â”‚  â”‚ brain_dump_id (FK)                                     â”‚ â”‚ â”‚
â”‚  â”‚ source_id (FK â†’ ideas.id)                             â”‚ â”‚ â”‚
â”‚  â”‚ target_id (FK â†’ ideas.id)                             â”‚ â”‚ â”‚
â”‚  â”‚ relationship_type (FK â†’ edge_types.id)                â”‚ â”‚ â”‚
â”‚  â”‚ label                                                   â”‚ â”‚ â”‚
â”‚  â”‚ created_at, updated_at                                 â”‚ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
                                                                 â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚                  idea_similarities [NEW]                     â”‚ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚ idea1_id (PK, FK â†’ ideas.id)                          â”‚ â”‚ â”‚
â”‚  â”‚ idea2_id (PK, FK â†’ ideas.id)                          â”‚ â”‚ â”‚
â”‚  â”‚ content_similarity float                               â”‚ â”‚ â”‚
â”‚  â”‚ context_similarity float                               â”‚ â”‚ â”‚
â”‚  â”‚ structural_similarity float                            â”‚ â”‚ â”‚
â”‚  â”‚ combined_score float â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”˜ â”‚
â”‚  â”‚ calculated_at                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                â”‚
â”‚  Purpose: Cache expensive similarity calculations             â”‚
â”‚  Usage: Speeds up layout and clustering algorithms            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   idea_clusters [NEW]                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ id (PK)                                                 â”‚ â”‚
â”‚  â”‚ brain_dump_id (FK)                                     â”‚ â”‚
â”‚  â”‚ name                                                    â”‚ â”‚
â”‚  â”‚ theme (AI-generated)                                   â”‚ â”‚
â”‚  â”‚ centroid_x, centroid_y                                 â”‚ â”‚
â”‚  â”‚ color                                                   â”‚ â”‚
â”‚  â”‚ created_at, updated_at                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ 1:N
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  cluster_members [NEW]                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ cluster_id (PK, FK â†’ idea_clusters.id)                â”‚ â”‚
â”‚  â”‚ idea_id (PK, FK â†’ ideas.id)                           â”‚ â”‚
â”‚  â”‚ membership_score float                                 â”‚ â”‚
â”‚  â”‚ is_core_member boolean                                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                â”‚
â”‚  Purpose: Track which ideas belong to which clusters          â”‚
â”‚  Usage: Visualization, filtering, theme-based operations      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Vector Index Structure

```
IVFFlat Index on ideas.embedding
â”‚
â”œâ”€ List 1 (centroid: [0.1, 0.2, ...])
â”‚  â”œâ”€ idea-1: [0.12, 0.19, ...]  (distance: 0.02)
â”‚  â”œâ”€ idea-5: [0.11, 0.21, ...]  (distance: 0.03)
â”‚  â””â”€ idea-9: [0.09, 0.18, ...]  (distance: 0.04)
â”‚
â”œâ”€ List 2 (centroid: [0.5, 0.6, ...])
â”‚  â”œâ”€ idea-2: [0.52, 0.58, ...]  (distance: 0.05)
â”‚  â”œâ”€ idea-6: [0.48, 0.62, ...]  (distance: 0.06)
â”‚  â””â”€ idea-10: [0.51, 0.59, ...] (distance: 0.02)
â”‚
â”œâ”€ List 3 (centroid: [-0.3, 0.8, ...])
â”‚  â”œâ”€ idea-3: [-0.28, 0.82, ...] (distance: 0.03)
â”‚  â”œâ”€ idea-7: [-0.32, 0.78, ...] (distance: 0.04)
â”‚  â””â”€ idea-11: [-0.29, 0.81, ...] (distance: 0.02)
â”‚
â””â”€ ... (100 lists total)

How Search Works:
1. Query embedding: [0.11, 0.20, ...]
2. Find nearest list centroids (e.g., List 1)
3. Search only within those lists (not all 10,000 ideas!)
4. Return top K most similar
5. Result: 100x faster than brute force
```

---

## ğŸ¯ Key Concepts Visualized

### Cosine Similarity
```
Vector A: [1, 2, 3]     Vector B: [2, 4, 6]
   â”‚                        â”‚
   â”‚                        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€angle Î¸â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
Similarity = cos(Î¸) = 1.0 (identical direction)

Vector A: [1, 0]        Vector B: [0, 1]
   â”‚                        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€90Â°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   
Similarity = cos(90Â°) = 0.0 (perpendicular)
```

### Graph Traversal
```
Start: idea-1
Depth 1: [idea-2, idea-3, idea-4]  (direct connections)
Depth 2: [idea-5, idea-6, idea-7, idea-8]  (2 hops away)
Depth 3: [idea-9, idea-10, ...]  (3 hops away)

Graph RAG uses depth-limited traversal to build context
without including the entire graph.
```

---

**This architecture enables**:
- âœ… Fast semantic search (< 500ms)
- âœ… Rich contextual AI responses
- âœ… Intelligent canvas organization
- âœ… Pattern discovery and clustering
- âœ… Scalable to 50K+ ideas

**Next**: See implementation tasks for step-by-step build guide

